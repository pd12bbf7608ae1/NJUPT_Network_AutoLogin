# NJUPT_Network_AutoLogin

南京邮电大学 校园网/电信宽带/移动宽带 自动登录Shell脚本

## 声明

本项目很多资源来自网上，均是开源项目，本人仅是收集整理测试。

严厉谴责利用本项目不正当牟利的行为。

## 校园网环境概述

自从2019年暑假学校网络整体升级以来，上网方式发生了很大变化，目前有两种接入方式：

+ 有线接入(网线)，可以在登录时选择校园网、中国电信、中国移动

+ 无线接入(NJUPT、NJUPT-CMCC、NJUPT-CHINANET)，每个运营商对应一个无线信号

登录方式为打开[p.njupt.edu.cn](http://p.njupt.edu.cn)，输入账号密码运营商进行登录(近期更改为[10.10.244.11](http://10.10.244.11/))。

经过实测(2019年底的情况)，目前三大运营商的特点为：

+ 校园网：走电信的出口，下行速度约为100M，上行5M(坑死人)。

+ 中国电信：走电信的出口，下行速度约办理套餐时约定的速率，上行为下行的5%(坑死人)。

+ 中国移动：走移动的出口，下行约300M，上行约500M，但移动网络的连通性较差，适合用来挂下载啥的。

并且，校园正式接入了中国教育与科研网(CERNET)，拥有了ipv6的访问权限。获取ipv6地址需要使用有线接入或者连接名称为`NJUPT`的无线网络，并且路由器等设备需要支持才行。特别指出的是，在当前的网络环境下，对大多数人来说，ipv6的用途不大，但认真研究一下，会有很大的用途。

本脚本适用于有线接入以及无线接入(包括路由器的中继)。

## 脚本的特点

目前在Github上已有很多的南京邮电自动登录脚本，我大致看了一下，其大部分都需要部署在路由器端(即部署脚本的设备需要能直接获得学校网络DHCP分配的ip地址)，这限制了路由器的品牌选择(很多品牌刷机不是很方便)。因此，我参考了相关项目的做法，并测试了学校的网络登录方法，写出了这个无需部署在路由器端的脚本(即可以部署于路由器NAT后的主机)。

+ 无需专用路由器(部署于路由器端也是可以的)

+ 利用学校提供的API获取相关参数，有较强的适用性

+ 增加了检测是否已经联网的功能、是否在联网时间的功能，可以作为一个定期检查脚本使用(避免因为路由器死机、停电等原因造成的断网，暂时没有考虑非周末的假期的因素)

+ 可以自行为`curl`添加proxy参数，进行一些骚操作(带宽叠加这种)

## 脚本使用

首先你需要掌握一定的Linux知识，知道如何进行一些简单的文件操作、脚本执行等。如果不会，请自行百度并整一台虚拟机练习一下。

你可能需要根据实际情况修改脚本的默认参数。目前的参数是针对我目前的使用环境得出，不排除后续学校会更改联网参数。近期可以无需修改使用，后续网络环境发生变化可能需要修改。

脚本位于`script`文件夹内，里面有不同的版本，各自按照自己的需求进行选择。

脚本依赖于`curl`命令，需要预先安装，安装方法自行百度。

假设脚本命名为`login.sh`，放置在目录`/home/ubuntu`下，以下操作需要在路由器上或者路由器NAT下的Linux运行环境中进行，后续会说明例子。

执行格式`sh /home/ubuntu/login.sh 账户类型 用户名 密码`，其中 账号类型 0表示校园网 1表示中国电信 2表示中国移动，例如`sh /home/ubuntu/login.sh 1 123456789 987654321`表示使用中国电信网，用户名为`123456789`，密码为`987654321`。

执行一次后，如果一切正常，就登录成功了。下面将脚本添加到`crontab`中定期执行(或者其他什么定期执行程序方法，自行搜索)。

首先给脚本执行的权限，命令`chmod +x /home/ubuntu/login.sh`；然后执行`crontab -e`打开编辑器(以nano为例)，将以下内容写入最后一行(自行替换相关参数)：

```
*/15 * * * * /home/ubuntu/login.sh 账户类型 用户名 密码 >/dev/null 2>&1
```

该参数的意思是，脚本每15分钟执行一次，并将所有输出丢弃。由于脚本带有了联网时间及是否处于联网状态的功能，实际中只有在断网并处于可以联网的时间段会进行登录操作。

随后使用`Ctrl + X`退出`crontab`的编辑，定时任务即部署完成。

下面就可以享受自动联网的便捷了。

至于登出嘛……手动吧(记得去除定期执行任务)，毕竟用这个脚本的人都是希望网络以尽可能长的时间在线的。

## 相关设备介绍

这里就如何选择这个脚本执行设备多说几句。脚本的资源消耗很低，因此基本只要是个Linux运行环境，有`curl`并且处于路由器的NAT下即可，下面列举一些常用的低价解决方法。

+ 可以执行自定义脚本的路由器(限定了路由器的选择)

+ 电脑开一个虚拟机或者Win10带的Linux子系统

+ 没用的安卓手机整一个termux软件跑脚本

+ 没用的旧电脑刷Linux系统

+ 树莓派等ARM架构的开发版

+ 斐讯N1盒子刷Armbian

各种方法的优劣即具体实施操作请自行上网搜索。

## 相关链接

[脚本存放文件夹](script/)

[脚本思路](how-to/Readme.md)

## 感谢

以下是本项目的一些参考项目，向前辈表示感谢：

[kaijianyi/NJUPT_NET](https://github.com/kaijianyi/NJUPT_NET)

[HK-Journalist/wlanlogin-njupt](https://github.com/HK-Journalist/wlanlogin-njupt)

[njupt10087/njupt_network](https://github.com/njupt10087/njupt_network)

[X3ZvaWQ/NJUPT_NET_2019](https://github.com/X3ZvaWQ/NJUPT_NET_2019)

[Dr.COM校园网多设备解决方案](https://jakting.com/archives/drcom-autologin-padavan-tgbot.html)
